# Offset-value coding in database query processing

https://www.alphaxiv.org/abs/2210.00034v3

## alphaxiv の日本語ブログ

https://www.alphaxiv.org/ja/overview/2210.00034v3

Offset-value coding(OVC) はソートされたデータを扱う際のパフォーマンス最適化技術の1つ。
キー全体を比較せず、キーの異なる最初の部分をエンコードしてソート中の比較を高速化する。


この論文では OVC をクエリ実行パイプライン全体に伝搬させるためのフレームワークを提示して、OVC をポイントで使うのではなく複雑な多重オペレータークエリで使えることを示す。

これまではオペレーターがコストのかかる処理なしに出力用の OVC を生成することはできなかったが、本研究では OVC をオペレーター間でシームレスに伝搬させるのに必要な理論的基礎と実用的なアルゴリズムを提供。

### 理論的基礎

コストのかかる再計算なしに効率的に OVC 伝搬を可能にする定理に焦点。

ソートされた A < B < C について、

$$ovc(A, C) = max(ovc(A, B), ovc(B, C))$$

となる。(降順の場合は min を使用)

OVCは文字列比較ではなく、単純な整数操作で計算できる。

上記を「フィルタ定理」で拡張。

$$X_0 < X_1 < ... < X_n$$ について、

$$\displaystyle ovc(X_0, X_n) = \max_{i=1}^n ovc(X_(i-1), X_i)$$

このフィルタ定理は行をスキップまたはフィルタリングするオペレーターを処理する上で重要。追加の列値比較なしに入力 OVC を用いて出力 OVC を計算。

### アルゴリズムフレームワーク

様々なリレーショナルオペレーターが OVC を効率的に出力を生成する方法を系統的に論じる。

フィルタリングやプロジェクションの場合はフィルタ定理を直接適用。
フィルタリングでは後続ではスキップ、プロジェクションでは OVC は単純なオフセット調整で計算できる。


グループ化や集計では OVC を用いてグループ境界を効率的に識別。重複除去では OVC で重複行(OVC がキーアリティ？に等しい行)を識別して、一意の値の最初の出現から OVC を伝搬できる。

マージ結合のようなオペレーターは追加の複雑さを伴うが、同様の原則に従う。入力ストリーム間での比較を OVC を用いて高速化。出力 OVC は結合タイプと一致パターンに基づいて導出され、フィルタ定理はマージで1つのストリームからの行がフィルタリングされるケースを処理。